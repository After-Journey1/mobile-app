$(function(){var e,i=[];function n(t,s){var o=0;t.each(function(){$(this).hasClass("h")||o++}),o==t.length?s.removeClass("h"):s.addClass("h")}function r(){var a=0,s=[];$(".goods .icon-a-red-tik").each(function(){if(!$(this).hasClass("h")){var t=parseFloat($(this).parents(".lines").find(".wbiaoPrice").html())*parseInt($(this).parents(".lines").find(".quatity span").html());console.log(t),s.push(t)}}),$.each(s,function(t,s){var o=parseFloat(s);(a+=o).toFixed(2)}),$("#payableAmount").text(a),$("#goodsAmount").text(a)}function t(){var t=$(this).parents(".shop-blocks").children(".goods").length;1==$(this).parents(".W-cart").children(".shop-blocks").length&&1==t&&($(this).parents(".shop-blocks").remove(),$(".wrapper1").hide(),$(".main1").show()),1==t&&$(this).parents(".shop-blocks").remove(),$(this).parents(".goods").remove(),r()}null!=getCookie("user")?($(".main1").hide(),$.ajax({type:"POST",url:"api/shopcar.php",dataType:"json",success:function(t){var s=document.getElementById("tpl").innerHTML,o=ejs.render(s,{list:t});$(".cart-content").html(o);var a=t.length;$("#index_cart .W_footer_tag").html(a),new IScroll(".wrapper1",{scrollX:!1,scrollY:!0,snap:!0}),$.each($(".slide-wrap"),function(t,s){$(this).addClass("s-wrap"+t),e=new IScroll(".s-wrap"+t,{scrollX:!0,scrollY:!1,probeType:3,snap:!0,click:!0}),i.push(e)}),r()}})):$("main").hide(),$(".car-right p").click(function(){$(this).toggleClass("h").siblings().toggleClass("h"),$(".desc").toggleClass("h"),$(".editor").toggleClass("h"),$(".slide-scroller").toggleClass("w"),$(".btns").toggleClass("h"),$.each(i,function(t,s){s.refresh()})}),$(".W-cart").on("click",".goods .cart-tik",function(){$(this).children(".icon-a-red-tik").toggleClass("h");var t=$(this).parents(".shop-blocks").find(".goods .icon-a-red-tik"),s=$(this).parents(".shop-blocks").find(".shop-title .icon-a-red-tik"),o=$(".goods .icon-a-red-tik"),a=$(".footer-bar .cart-tik .icon-a-red-tik");n(t,s),n(o,a),r()}),$(".W-cart").on("click",".shop-title .cart-tik",function(){$(this).children(".icon-a-red-tik").toggleClass("h"),$(this).parents(".shop-blocks").find(".goods .icon-a-red-tik").toggleClass("h"),n($(".shop-blocks").find(".shop-title .icon-a-red-tik"),$(".footer-bar .cart-tik .icon-a-red-tik")),r()}),$(".footer-bar").on("click",".cart-tik",function(){var t=$(this).children(".icon-a-red-tik");t.hasClass("h")?(t.removeClass("h"),$(".W-cart").find(".icon-a-red-tik").removeClass("h"),console.log("remove")):(t.addClass("h"),$(".W-cart").find(".icon-a-red-tik").addClass("h"),console.log("add")),r()}),$(".W-cart").on("click",".plus",function(){var t=$(this).prev().html();t++,$(this).prev().html(t),$(this).parents(".inner").find(".quatity span").html(t),r();var s=$(this).prev().html(),o=$(this).parents(".goods").data("goodsid");console.log(s),$.ajax({type:"post",url:"api/cartAdd.php",data:{goodsNum:s,goodsID:o},success:function(t){1==t.code&&r()}})}),$(".W-cart").on("click",".minus",function(){var t=$(this).next().html();0==--t&&(t=1),$(this).next().html(t),$(this).parents(".inner").find(".quatity span").html(t),r();var s=$(this).next().html(),o=$(this).parents(".goods").data("goodsid");$.ajax({type:"post",url:"api/cartAdd.php",data:{goodsNum:s,goodsID:o},success:function(t){1==t.code&&r()}})}),$(".W-cart").on("tap",".to-delete",t),$(".W-cart").on("tap",".del",t)});